<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>í™€ì§ ê²Œì„ - Private Game Platform</title>
    <link rel="stylesheet" href="css/game.css" />
    <link rel="stylesheet" href="/common.css" />
    <script src="js/client_common.js"></script>
  </head>
  <body>
    <!-- í—¤ë” -->
    <div id="header"></div>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <main class="main-content">
      <div class="container">
        <div class="game-container">
          <!-- ê²Œì„ í—¤ë” -->
          <div class="game-header">
            <h1 class="game-title">ğŸ² í™€ì§ ê²Œì„</h1>
            <div class="game-status">â— ê²Œì„ ìš´ì˜ ì¤‘</div>
          </div>

          <!-- í¬ì¸íŠ¸ ì •ë³´ -->
          <div class="points-info">
            <div class="current-points">í˜„ì¬ ë³´ìœ  í¬ì¸íŠ¸</div>
            <div class="points-value point-value" id="currentPoints"></div>
          </div>

          <!-- ê²Œì„ ë³´ë“œ -->
          <div class="game-board">
            <!-- ë² íŒ… ê¸ˆì•¡ ì…ë ¥ -->
            <div class="bet-amount-section">
              <label class="form-label">ë² íŒ… ê¸ˆì•¡</label>
              <div class="bet-input-group">
                <input
                  type="number"
                  id="betAmount"
                  class="form-input"
                  placeholder="ê¸ˆì•¡ ì…ë ¥"
                  min="1000"
                  max="100000"
                  step="1000"
                  value="10000"
                />
              </div>
              <div class="quick-bet-buttons">
                <button class="quick-bet-btn" onclick="setBetAmount(1000)">
                  1ì²œ
                </button>
                <button class="quick-bet-btn" onclick="setBetAmount(5000)">
                  5ì²œ
                </button>
                <button class="quick-bet-btn" onclick="setBetAmount(10000)">
                  1ë§Œ
                </button>
                <button class="quick-bet-btn" onclick="setBetAmount(50000)">
                  5ë§Œ
                </button>
                <button class="quick-bet-btn" onclick="setBetAmount(100000)">
                  10ë§Œ
                </button>
              </div>
            </div>

            <!-- í™€ì§ ì„ íƒ -->
            <div class="choice-section">
              <label class="form-label">í™€ì§ ì„ íƒ</label>
              <div class="choice-buttons">
                <div
                  class="choice-btn"
                  id="oddBtn"
                  onclick="selectChoice('odd')"
                >
                  <div class="icon">1ï¸âƒ£</div>
                  <div class="label">í™€</div>
                </div>
                <div
                  class="choice-btn"
                  id="evenBtn"
                  onclick="selectChoice('even')"
                >
                  <div class="icon">2ï¸âƒ£</div>
                  <div class="label">ì§</div>
                </div>
              </div>
            </div>

            <!-- ê²°ê³¼ í‘œì‹œ -->
            <div class="result-display" id="resultDisplay">
              <div class="dice-container" id="diceContainer">?</div>
              <div class="result-text">ì£¼ì‚¬ìœ„ë¥¼ êµ´ë ¤ë³´ì„¸ìš”!</div>
            </div>

            <!-- ë² íŒ… ë²„íŠ¼ -->
            <button
              class="btn btn-primary bet-button"
              id="betButton"
              onclick="placeBet()"
            >
              ë² íŒ…í•˜ê¸°
            </button>

            <!-- ê²Œì„ ì •ë³´ -->
            <div class="game-info">
              ğŸ’¡ ë°°ë‹¹ë¥ : 1.95ë°° | ìµœì†Œ ë² íŒ…: 1,000ì› | ìµœëŒ€ ë² íŒ…: 100,000ì›
            </div>
          </div>

          <!-- ìµœê·¼ ë² íŒ… ê²°ê³¼ -->
          <div class="recent-results">
            <h3>ìµœê·¼ ë² íŒ… ê²°ê³¼</h3>
            <div class="result-list" id="resultList">
              <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- í‘¸í„° -->
    <footer class="footer">
      <div class="container">
        <p>&copy; 2025 Private Game Platform. All rights reserved.</p>
        <p>ë¬¸ì˜: support@pgp.com</p>
      </div>
    </footer>

    <script>
      let selectedChoice = null;
      let isPlaying = false;

      // ë² íŒ… ê¸ˆì•¡ ì„¤ì •
      function setBetAmount(amount) {
        document.getElementById("betAmount").value = amount;
      }

      // í™€ì§ ì„ íƒ
      function selectChoice(choice) {
        selectedChoice = choice;
        document.getElementById("oddBtn").classList.remove("selected");
        document.getElementById("evenBtn").classList.remove("selected");

        if (choice === "odd") {
          document.getElementById("oddBtn").classList.add("selected");
        } else {
          document.getElementById("evenBtn").classList.add("selected");
        }
      }

      async function placeBet() {
        if (isPlaying) return;

        const betAmount = parseInt(document.getElementById("betAmount").value);
        const choice = selectedChoice;
        const currentPoint = window.userState.point;

        // 1ì°¨ í”„ë¡ íŠ¸ ê²€ì¦ (UXìš©)
        if (!betAmount || betAmount < 1000) {
          alert("ìµœì†Œ ë² íŒ… ê¸ˆì•¡ì€ 1,000ì›ì…ë‹ˆë‹¤.");
          return;
        }

        if (!choice) {
          alert("í™€/ì§ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
          return;
        }

        if (betAmount > currentPoint) {
          alert("ë³´ìœ  í¬ì¸íŠ¸ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.");
          return;
        }

        isPlaying = true;
        document.getElementById("betButton").disabled = true;

        try {
          const response = await fetch("/games/play", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ betAmount, choice: selectedChoice }),
          });

          const result = await response.json();

          if (!response.ok) {
            alert(result.message);
            resetGameState();
            return;
          }

          //ì„œë²„ ê²°ê³¼ ê¸°ë°˜ ì• ë‹ˆë©”ì´ì…˜ ì‹¤í–‰
          rollDiceAnimation(result, betAmount);
        } catch (err) {
          console.error(err);
          alert("ì„œë²„ ì˜¤ë¥˜ ë°œìƒ");
          resetGameState();
        }
      }

      // ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°
      function rollDiceAnimation(serverResult, betAmount) {
        const diceContainer = document.getElementById("diceContainer");

        diceContainer.classList.add("rolling");

        let count = 0;

        const interval = setInterval(() => {
          diceContainer.textContent = Math.floor(Math.random() * 6) + 1;
          count++;

          if (count >= 15) {
            clearInterval(interval);

            //ì„œë²„ì—ì„œ ë°›ì€ ì§„ì§œ ê²°ê³¼ í‘œì‹œ
            diceContainer.textContent = serverResult.dice;
            diceContainer.classList.remove("rolling");

            setTimeout(() => {
              showResult(serverResult, betAmount);
            }, 500);
          }
        }, 100);
      }

      // ê²°ê³¼ í‘œì‹œ
      function showResult(serverResult, betAmount) {
        const resultDisplay = document.getElementById("resultDisplay");

        const isWin = serverResult.result === 1;

        if (isWin) {
          resultDisplay.innerHTML = `ğŸ‰ ìŠ¹ë¦¬! +${serverResult.payout.toLocaleString()}ì›`;
          resultDisplay.className = "result win";
        } else {
          resultDisplay.innerHTML = `âŒ íŒ¨ë°°! -${betAmount.toLocaleString()}ì›`;
          resultDisplay.className = "result lose";
        }

        //point ì—…ë°ì´íŠ¸
        window.userState.point = result.currentPoint;
        updatePointUI(result.currentPoint);

        resetGameState();
      }

      function resetGameState() {
        isPlaying = false;
        document.getElementById("betButton").disabled = false;
      }
    </script>
  </body>
</html>
